// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// جدول المستخدمين (الموظفين)
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("admin") // admin, trainer, receptionist
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// جدول المشتركين
model Member {
  id            String         @id @default(cuid())
  memberNumber  String         @unique // رقم العضوية
  fullName      String
  phone         String
  email         String?
  nationalId    String?
  dateOfBirth   DateTime?
  gender        String         // male, female
  address       String?
  emergencyContact String?
  emergencyPhone String?
  photo         String?        // مسار الصورة
  joinDate      DateTime       @default(now())
  status        String         @default("active") // active, inactive, suspended
  notes         String?
  
  subscriptions Subscription[]
  attendance    Attendance[]
  payments      Payment[]
  invoices      Invoice[]
  transactions  Transaction[]
  
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

// جدول الباقات
model Package {
  id            String         @id @default(cuid())
  name          String         // اسم الباقة
  nameEn        String?        // Package name in English
  duration      Int            // المدة بالأيام
  price         Float          // السعر
  description   String?
  features      String?        // المميزات (JSON)
  isActive      Boolean        @default(true)
  
  subscriptions Subscription[]
  
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

// جدول الاشتراكات
model Subscription {
  id          String    @id @default(cuid())
  memberId    String
  packageId   String
  startDate   DateTime
  endDate     DateTime
  status      String    @default("active") // active, expired, cancelled
  amount      Float
  notes       String?
  
  member      Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  package     Package   @relation(fields: [packageId], references: [id])
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// جدول الحضور
model Attendance {
  id          String    @id @default(cuid())
  memberId    String
  checkIn     DateTime  @default(now())
  checkOut    DateTime?
  date        String    // تاريخ الحضور (YYYY-MM-DD)
  notes       String?
  
  member      Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime  @default(now())
}

// جدول المدفوعات المتقدم
model Payment {
  id              String    @id @default(cuid())
  memberId        String
  member          Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  invoiceId       String?
  invoice         Invoice?  @relation(fields: [invoiceId], references: [id])
  amount          Float
  currency        String    @default("SAR")
  method          String    // CASH, CARD, BANK_TRANSFER, PAYPAL, STRIPE, APPLE_PAY, GOOGLE_PAY
  status          String    // PENDING, COMPLETED, FAILED, REFUNDED, CANCELLED
  transactionId   String?   @unique
  gateway         String?
  gatewayResponse String?   // JSON as string
  description     String?
  receiptUrl      String?
  receiptNumber   String?   @unique
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// جدول الفواتير
model Invoice {
  id            String        @id @default(cuid())
  invoiceNumber String        @unique
  memberId      String
  member        Member        @relation(fields: [memberId], references: [id], onDelete: Cascade)
  items         InvoiceItem[]
  subtotal      Float
  discount      Float         @default(0)
  tax           Float         @default(0)
  total         Float
  status        String        @default("PENDING") // DRAFT, PENDING, PAID, OVERDUE, CANCELLED
  dueDate       DateTime
  paidDate      DateTime?
  payments      Payment[]
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

// بنود الفاتورة
model InvoiceItem {
  id          String  @id @default(cuid())
  invoiceId   String
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  description String
  quantity    Int
  unitPrice   Float
  total       Float
}

// كوبونات الخصم
model Coupon {
  id          String   @id @default(cuid())
  code        String   @unique
  type        String   // PERCENTAGE, FIXED_AMOUNT
  value       Float
  minAmount   Float?
  maxUses     Int?
  usedCount   Int      @default(0)
  validFrom   DateTime
  validUntil  DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

// سجل المعاملات المالية
model Transaction {
  id          String   @id @default(cuid())
  type        String   // INCOME, EXPENSE, REFUND
  amount      Float
  memberId    String?
  member      Member?  @relation(fields: [memberId], references: [id])
  description String
  reference   String?
  createdAt   DateTime @default(now())
}

// جدول الإعدادات
model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}
