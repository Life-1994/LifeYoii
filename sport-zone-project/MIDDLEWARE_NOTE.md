# ููุงุญุธุฉ ุญูู ุงูู Middleware

## ุงููุดููุฉ ุงูุญุงููุฉ

ููุงู ูุดููุฉ ุชูุงูู ุจูู NextAuth v5 (beta) ู Next.js 14.0.4 ูุน ุงูู Edge Runtime ุงููุณุชุฎุฏู ูู ุงูู middleware.

### ุงูุฎุทุฃ
```
TypeError: next_dist_server_web_exports_next_request__WEBPACK_IMPORTED_MODULE_0__ is not a constructor
```

### ุงูุณุจุจ
- NextAuth v5 ูุง ุฒุงู ูู ูุฑุญูุฉ beta
- Edge Runtime ูุง ูุฏุนู ุฌููุน Node.js APIs (ูุซู speakeasy ุงููุณุชุฎุฏู ูู 2FA)
- ูุดุงูู ุชูุงูู ุจูู ุงูุฅุตุฏุงุฑุงุช

## ุงูุญู ุงููุคูุช

ุชู ุชุนุทูู ุงูู middleware (`src/middleware.ts.disabled`) ูุงุณุชุฎุฏุงู ุญูุงูุฉ ุนูู ูุณุชูู ุงูุตูุญุงุช ุจุฏูุงู ููู.

### ุงูุญูุงูุฉ ุงูุญุงููุฉ

1. **ุตูุญุงุช ุงููุตุงุฏูุฉ** (`app/(auth)/layout.tsx`)
   - ุชุชุญูู ูู ุงูุฌูุณุฉ
   - ุชุนูุฏ ุงูุชูุฌูู ุฅุฐุง ูุงู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู

2. **ุงูุตูุญุงุช ุงููุญููุฉ**
   - ุงุณุชุฎุฏู `requireAuth()` ูู Server Components
   - ุงุณุชุฎุฏู `requireRole(['ADMIN'])` ููุตูุญุงุช ุงูุฅุฏุงุฑูุฉ

### ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู

```typescript
// ูู ุตูุญุฉ ูุญููุฉ
import { requireAuth, requireRole } from "@/lib/auth"

export default async function ProtectedPage() {
  // ููุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ููุท
  const user = await requireAuth()
  
  // ููุชุญูู ูู ุงูุฏูุฑ
  const admin = await requireRole(["ADMIN"])
  
  return <div>ูุญุชูู ูุญูู</div>
}
```

## ุงูุญููู ุงููุณุชูุจููุฉ

### ุงูุฎูุงุฑ 1: ุงูุชุธุงุฑ NextAuth v5 Stable
ุนูุฏูุง ูุตุฏุฑ NextAuth v5 ุจุดูู ูุณุชูุฑุ ูุฌุจ ุฃู ุชุญู ูุดุงูู ุงูุชูุงูู.

### ุงูุฎูุงุฑ 2: ุงุณุชุฎุฏุงู Next.js 15
Next.js 15 ูุญุชูู ุนูู ุชุญุณููุงุช ูู Edge Runtime ูุฏ ุชุญู ุงููุดููุฉ.

### ุงูุฎูุงุฑ 3: Middleware ูุจุณุท
ูููู ุงุณุชุฎุฏุงู middleware ูุจุณุท ูุนุชูุฏ ุนูู NextAuth middleware ููุท:

```typescript
export { auth as middleware } from "@/lib/auth"

export const config = {
  matcher: ["/((?!api|_next/static|_next/image|favicon.ico).*)"],
}
```

## ุงูุชูุตูุงุช

1. โ ุงูุญูุงูุฉ ุงูุญุงููุฉ ูุงููุฉ ููุฅูุชุงุฌ
2. โ ุงุณุชุฎุฏู server-side checks ูู ุงูุตูุญุงุช
3. โ๏ธ ุฑุงูุจ ุชุญุฏูุซุงุช NextAuth v5
4. ๐ ุนูุฏ ุงูุชุฑููุฉ ูู NextAuth v5 stableุ ุฃุนุฏ ุชูุนูู ุงูู middleware

## ุงูุงุฎุชุจุงุฑ

ุชู ุงุฎุชุจุงุฑ ุฌููุน ุงูุตูุญุงุช ูุงููุธุงุฆู ูุชุนูู ุจุดูู ุตุญูุญ:
- โ ุชุณุฌูู ุงูุฏุฎูู
- โ ุงูุชุณุฌูู
- โ ูุณูุช ูููุฉ ุงููุฑูุฑ
- โ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ
- โ OAuth (ุฌุงูุฒ ููุชูุนูู)
- โ ุญูุงูุฉ ุงูุตูุญุงุช

---

**ุขุฎุฑ ุชุญุฏูุซ:** ููููุจุฑ 2024
